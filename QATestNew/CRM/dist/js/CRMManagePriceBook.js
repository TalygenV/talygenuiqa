(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["CRMManagePriceBook"],{"34b0":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"main-content"},[a("loader",{attrs:{"is-visible":t.isLoading}}),a("div",{attrs:{id:"divMainLeadData"}},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12 padding-t_8"},[a("div",{staticClass:"theme-primary partition-full"},[a("span",{staticClass:"p-name text-white"},[t._v(t._s(t.$t("CAMANAGESTAGE")))])])])]),a("div",{staticClass:"border p-3"},[a("Form",{ref:"form"},[a("dynamic-form",{ref:"PriceBookForm",attrs:{lang:"en",buttons:t.buttons,schema:t.FormSchema},on:{OnSubmit:t.onSubmit},scopedSlots:t._u([{key:"tgslot-PriceBookTable",fn:function(e){e.data;return[t.isPriceInfo?a("div",{staticClass:"listing p-3"},[a("div",{staticClass:"table-responsive"},[a("table",{staticClass:"table table-bordered dt-responsive nowrap mt-0",staticStyle:{width:"100%","min-width":"650px!important"},attrs:{id:"priceBookTable","aria-describedby":"pricebooktable"}},[a("thead",{staticClass:"thead-bg"},[a("tr",{staticClass:"text-capitalize"},[a("th",{attrs:{scope:"col"}},[a("span",[t._v(t._s(t.$t("RangeFrom")))])]),a("th",{attrs:{scope:"col"}},[a("span",[t._v(t._s(t.$t("RangeTo")))])]),a("th",{attrs:{scope:"col"}},[a("span",[t._v(t._s(t.$t("Discount"))+" "+t._s(2==t.discountType?"(%)":"(Flat)"))])]),a("th",{staticClass:"text-center",attrs:{scope:"col"}},[a("span",[t._v(t._s(t.$t("Action")))])])])]),a("tbody",t._l(t.priceInformation,(function(e,n){return a("tr",{key:n},[a("td",[a("Field",{attrs:{name:"rangeFrom"+n,rules:{required:!0,numeric:!0,min_value:n>0?parseInt(t.priceInformation[n-1].rangeTo)+1:1},label:"Range From"},scopedSlots:t._u([{key:"default",fn:function(i){var o=i.errors,r=i.touched,s=i.invalid;return[a("input",{directives:[{name:"model",rawName:"v-model",value:e.rangeFrom,expression:"item.rangeFrom"}],class:{"form-control":!0,"is-invalid":r&&s},attrs:{type:"text",name:"rangeFrom"+n,id:"rangeFrom"+n},domProps:{value:e.rangeFrom},on:{input:[function(a){a.target.composing||t.$set(e,"rangeFrom",a.target.value)},function(a){return t.changevalue(e)}]}}),a("span",{staticClass:"invalid-feedback d-block",attrs:{name:t.rangeFrom}},[t._v(t._s(o[0]))])]}}],null,!0)})],1),a("td",[a("Field",{attrs:{name:"rangeTo"+n,rules:{required:!0,numeric:!0,min_value:parseInt(""==e.rangeFrom?0:e.rangeFrom)+1},label:"Range To"},scopedSlots:t._u([{key:"default",fn:function(i){var o=i.errors,r=i.touched,s=i.invalid;return[a("input",{directives:[{name:"model",rawName:"v-model",value:e.rangeTo,expression:"item.rangeTo"}],class:{"form-control":!0,"is-invalid":r&&s},attrs:{type:"text",name:"rangeTo"+n,id:"rangeTo"+n},domProps:{value:e.rangeTo},on:{input:function(a){a.target.composing||t.$set(e,"rangeTo",a.target.value)}}}),a("span",{staticClass:"invalid-feedback d-block",attrs:{name:t.rangeTo}},[t._v(t._s(o[0]))])]}}],null,!0)})],1),a("td",[a("Field",{attrs:{name:"discount"+n,rules:{required:!0,numeric:!0,max_value:100},label:"Discount"},scopedSlots:t._u([{key:"default",fn:function(i){var o=i.errors,r=i.touched,s=i.invalid;return[a("input",{directives:[{name:"model",rawName:"v-model",value:e.discount,expression:"item.discount"}],class:{"form-control":!0,"is-invalid":r&&s},attrs:{type:"text",name:"discount"+n,id:"discount"+n},domProps:{value:e.discount},on:{keyup:function(a){return t.discountFix(n,e.discount)},input:function(a){a.target.composing||t.$set(e,"discount",a.target.value)}}}),a("span",{staticClass:"invalid-feedback d-block",attrs:{name:t.discount}},[t._v(t._s(o[0]))])]}}],null,!0)})],1),a("td",{staticClass:"text-center single-action"},[a("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.deletePriceDetailRow(n)}}},[a("em",{staticClass:"fa fa-trash action-icon text-danger"})])])])})),0)]),a("div",{staticClass:"col-lg-12 add-form-field text-right py-3"},[a("a",{staticClass:"btn btn-success",attrs:{href:"javascript:;"},on:{click:function(e){return t.addNewForPriceDetails()}}},[a("em",{staticClass:"fa fa-plus pr-2",attrs:{"aria-hidden":"true"}}),t._v(t._s(t.$t("AddMore")))])])])]):t._e()]}}])}),a("div",{staticClass:"col-lg-6"},[a("div",{staticClass:"py-2"},[a("small",[a("span",{staticClass:"text-danger"},[t._v(" "+t._s(t.$t("MandatoryString")))])])])])],1)],1)])],1)},i=[],o=a("c7eb"),r=a("1da1"),s=(a("d3b7"),a("159b"),a("b0c0"),a("a434"),a("ac1f"),a("1276"),a("b680"),a("e9c4"),a("9769")),c={data:function(){return{isLoading:!1,pricebookid:this.$route.params.id,userId:null,compnayId:null,dateformat:null,isPriceInfo:!1,discountType:0,onEditPriceInfo:!1,priceInformation:[],FormSchema:[],buttons:[{type:"submit",class:"btn btn-success save",text:"<i class='fa fa-save pr-2'></i>Submit"},{type:"button",class:"btn btn-danger",text:"<i class='fa fa-close pr-2'></i>Cancel",onClick:this.onCancel}]}},created:function(){this.userId=this.GetUserInfo.ID,this.companyId=this.GetUserInfo.CompanyId,this.dateformat=this.GetUserInfo.DateFormat,this.FetchData()},methods:{onCancel:function(){this.$router.push({name:"CRMPriceBook"})},FetchData:function(){var t=this;t.isLoading=!0;var e="id=".concat(t.$route.params.id,"&moduleName=CRM&subModuleCode=CRM_PRICE_BOOKS&langCode=en");s["a"].getFormLayout(e).then((function(e){t.isLoading=!1,t.FormSchema=t.$refs.PriceBookForm.ConvertCustomFieldIntoDynamicFormObj(e.data.data),t.FormSchema.forEach((function(e,a){e.Data.forEach(function(){var e=Object(r["a"])(Object(o["a"])().mark((function e(a,n){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:"price_book_owner"==a.name&&(a.config.onSearchChange=t.onSearch),a.config.onChange=t.onChangeEventForFields;case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}())})),t.FormSchema.push({layoutType:"single",Data:[{astype:"SlotField",name:"PriceBookTable",value:"",visibility:!1}]}),""!=e.data.otherData&&void 0!==e.data.otherData&&(t.isPriceInfo=!0,t.FormSchema[1].Data[0].visibility=!0,t.priceInformation=e.data.otherData)}))},onSearch:function(t,e,a){var n=this;n.searchSelectData(a,n,e)},searchSelectData:function(t,e,a){this.ShowSearchData(t,e,a)},ShowSearchData:function(){var t=Object(r["a"])(Object(o["a"])().mark((function t(e,a,n){var i,r;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=this,r="id=&&moduleName=CRM&type=CRM_USERS&search=".concat(e,"&refId="),"undefined"==typeof n&&(n=0),n.config.options=[],t.next=6,s["a"].getDDLData(r).then((function(t){t.data&&(i.JsonObj=t.data,null!=i.JsonObj&&(t.data.DATA.forEach((function(t){var e={value:t.value,name:t.name};n.config.options.push(e)})),i.$refs.PriceBookForm.UpdateKeyValue()))}));case 6:case"end":return t.stop()}}),t,this)})));function e(e,a,n){return t.apply(this,arguments)}return e}(),onChangeEventForFields:function(t,e,a){var n=this;"price_book_model"==e.name&&(n.FormSchema[1].Data[0].visibility=!0,""!=e.value&&void 0!==e.value&&"0"!=e.value?(n.onEditPriceInfo?n.onEditPriceInfo=!1:(n.priceInformation=[],n.priceDetails()),n.isPriceInfo=!0,n.discountType=null==e.value||""==e.value?0:e.value):(n.priceInformation=[],n.isPriceInfo=!1))},priceDetails:function(){var t={rangeFrom:"",rangeTo:"",discount:""};this.priceInformation.push(t)},addNewForPriceDetails:function(){if(""!=this.priceInformation[this.priceInformation.length-1].rangeFrom&&""!=this.priceInformation[this.priceInformation.length-1].rangeTo){var t={rangeFrom:"",rangeTo:"",discount:""};this.priceInformation.push(t)}else this.ShowAlert(this.$t("lastOneRowRequired"),"warning",!0,this.$t("Alert"))},deletePriceDetailRow:function(t){var e=this;if(1==e.priceInformation.length)return this.ShowAlert(this.$t("Atleastonerowismandatorytosave"),"warning",!0,this.$t("Alert")),!1;e.confirmR(this.$t("AssetGroup_ConfirmDelete"),!0,this.$t("Delete",["Price Details"]),(function(){e.priceInformation.splice(t,1),e.priceInformation.length<=0&&e.addNewForPriceDetails()}))},changevalue:function(t){parseInt(t.rangeFrom)>=parseInt(t.rangeTo)&&(t.rangeTo="")},discountFix:function(t,e){var a=this;if(e.indexOf(".")>=0){var n=e.split(".");n.length>1&&""!=n[1]&&(n[1].length>1?a.priceInformation[t].discount=parseFloat(e).toFixed(2):a.priceInformation[t].discount=parseFloat(e).toFixed(1))}},onSubmit:function(t,e){var a=this;a.$refs.form.validate().then((function(t){if(t){a.isLoading=!0;var e=a.$refs.PriceBookForm.ConvertDynamicFormObjToCustomFieldObj(a.FormSchema);e.forEach((function(t){"created_by"==t.field_name&&(t.field_value=a.userId),"modified_by"==t.field_name&&(t.field_value=a.userId),"company_id"==t.field_name&&(t.field_value=a.companyId),"price_book_id"==t.field_name&&(t.field_value=a.pricebookid)}));var n={data:e,priceInformation:a.priceInformation},i=JSON.stringify(n);s["a"].PostPriceBook(i).then((function(t){a.isLoading=!1,"1"==t.data[0].Code?(a.pricebookid>0?a.ShowAlert(a.$t("UpdatedSuccess",[a.$t("PriceBook")]),"success",!0,a.$t("Alert")):a.ShowAlert(a.$t("AddedSuccess",[a.$t("PriceBook")]),"success",!0,a.$t("Alert")),a.$router.push({name:"CRMPriceBook"})):a.ShowAlert(a.$t("AddedError",[a.$t("PriceBook")]),"failure",!0,a.$t("Alert"))}))}}))}}},l=c,d=a("2877"),u=Object(d["a"])(l,n,i,!1,null,null,null);e["default"]=u.exports}}]);
//# sourceMappingURL=CRMManagePriceBook.js.map