(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["CRMManagePriceBook"],{c6ed:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"main-content"},[a("loader",{attrs:{"is-visible":e.isLoading}}),a("div",{attrs:{id:"divMainLeadData"}},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12 padding-t_8"},[a("div",{staticClass:"theme-primary partition-full"},[a("span",{staticClass:"p-name text-white"},[e._v(e._s(e.$t("ManagePriceBook")))]),a("span",{staticClass:"float-right"})])])]),a("div",{staticClass:"border p-3"},[a("Form",{ref:"form",scopedSlots:e._u([{key:"default",fn:function(t){var n=t.valid,i=t.errors;return[a("DynamicForm",{attrs:{schema:e.GroupBy,dateformat:e.dateformat,DependentOption:e.DependentOption,subModuleCode:e.$route.params.subModuleCode},on:{setDependentDate:e.DependentDateObject,onchangeForNormalDDL:e.onchangeForNormalDDL,onSearchDDL:e.onSearch,setSelectedValue:e.setSelectedValue}}),e.isPriceInfo?a("div",{staticClass:"listing p-3"},[a("div",{staticClass:"table-responsive"},[a("table",{staticClass:"table table-bordered dt-responsive nowrap mt-0",staticStyle:{width:"100%","min-width":"650px!important"},attrs:{id:"priceBookTable","aria-describedby":"pricebooktable"}},[a("thead",{staticClass:"thead-bg"},[a("tr",{staticClass:"text-capitalize"},[a("th",{attrs:{scope:"col"}},[a("span",[e._v(e._s(e.$t("RangeFrom")))])]),a("th",{attrs:{scope:"col"}},[a("span",[e._v(e._s(e.$t("RangeTo")))])]),a("th",{attrs:{scope:"col"}},[a("span",[e._v(e._s(e.$t("Discount"))+" "+e._s(2==e.discountType?"(%)":"(Flat)"))])]),a("th",{staticClass:"text-center",attrs:{scope:"col"}},[a("span",[e._v(e._s(e.$t("Action")))])])])]),a("tbody",e._l(e.priceInformation,(function(t,n){return a("tr",{key:n},[a("td",[a("Field",{attrs:{name:"rangeFrom"+n,rules:{required:!0,numeric:!0,min_value:n>0?parseInt(e.priceInformation[n-1].rangeTo)+1:1},label:"Range From"},scopedSlots:e._u([{key:"default",fn:function(i){var o=i.errors,r=i.touched,s=i.invalid;return[a("input",{directives:[{name:"model",rawName:"v-model",value:t.rangeFrom,expression:"item.rangeFrom"}],class:{"form-control":!0,"is-invalid":r&&s},attrs:{type:"text",name:"rangeFrom"+n,id:"rangeFrom"+n},domProps:{value:t.rangeFrom},on:{input:[function(a){a.target.composing||e.$set(t,"rangeFrom",a.target.value)},function(a){return e.changevalue(t)}]}}),a("span",{staticClass:"invalid-feedback d-block",attrs:{name:e.rangeFrom}},[e._v(e._s(o[0]))])]}}],null,!0)})],1),a("td",[a("Field",{attrs:{name:"rangeTo"+n,rules:{required:!0,numeric:!0,min_value:parseInt(""==t.rangeFrom?0:t.rangeFrom)+1},label:"Range To"},scopedSlots:e._u([{key:"default",fn:function(i){var o=i.errors,r=i.touched,s=i.invalid;return[a("input",{directives:[{name:"model",rawName:"v-model",value:t.rangeTo,expression:"item.rangeTo"}],class:{"form-control":!0,"is-invalid":r&&s},attrs:{type:"text",name:"rangeTo"+n,id:"rangeTo"+n},domProps:{value:t.rangeTo},on:{input:function(a){a.target.composing||e.$set(t,"rangeTo",a.target.value)}}}),a("span",{staticClass:"invalid-feedback d-block",attrs:{name:e.rangeTo}},[e._v(e._s(o[0]))])]}}],null,!0)})],1),a("td",[a("Field",{attrs:{name:"discount"+n,rules:{required:!0,numeric:!0,max_value:100},label:"Discount"},scopedSlots:e._u([{key:"default",fn:function(i){var o=i.errors,r=i.touched,s=i.invalid;return[a("input",{directives:[{name:"model",rawName:"v-model",value:t.discount,expression:"item.discount"}],class:{"form-control":!0,"is-invalid":r&&s},attrs:{type:"text",name:"discount"+n,id:"discount"+n},domProps:{value:t.discount},on:{keyup:function(a){return e.discountFix(n,t.discount)},input:function(a){a.target.composing||e.$set(t,"discount",a.target.value)}}}),a("span",{staticClass:"invalid-feedback d-block",attrs:{name:e.discount}},[e._v(e._s(o[0]))])]}}],null,!0)})],1),a("td",{staticClass:"text-center single-action"},[a("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.deletePriceDetailRow(n)}}},[a("em",{staticClass:"fa fa-trash action-icon text-danger"})])])])})),0)]),a("div",{staticClass:"col-lg-12 add-form-field text-right py-3"},[a("a",{staticClass:"btn btn-success",attrs:{href:"javascript:;"},on:{click:function(t){return e.addNewForPriceDetails()}}},[a("em",{staticClass:"fa fa-plus pr-2",attrs:{"aria-hidden":"true"}}),e._v(e._s(e.$t("AddMore")))])])])]):e._e(),a("div",{staticClass:"row flex-row-reverse mt-2"},[a("div",{staticClass:"col-lg-6 text-right"},[a("a",{staticClass:"btn btn-success add_pricebbok_a",class:{disabled:e.submited},attrs:{href:"javascript:;",title:"Save"},on:{click:function(t){return e.SubmitData(n,i)}}},[a("em",{staticClass:"fa fa-save pr-2"}),e._v(e._s(e.$t("Save"))+" ")]),e._v("Â  "),a("a",{staticClass:"btn btn-danger",attrs:{href:"javascript:void(0)",title:"Cancel"},on:{click:e.onCancel}},[a("em",{staticClass:"fa fa-close pr-2"}),e._v(e._s(e.$t("Cancel"))+" ")])]),a("div",{staticClass:"col-lg-6"},[a("div",{staticClass:"py-2"},[a("small",{staticClass:"text-danger"},[e._v(e._s(e.$t("MandatoryString")))])])])])]}}])})],1)])],1)},i=[],o=a("53ca"),r=(a("b0c0"),a("ac1f"),a("1276"),a("b680"),a("a434"),a("00b4"),a("4de4"),a("d3b7"),a("a15b"),a("e9c4"),a("498a"),a("159b"),a("9769")),s=a("5ba0"),l={components:{DynamicForm:s["a"]},data:function(){return{isLoading:!1,value:"",LeadData:null,LeadOwner:null,GroupBy:[],Channel:null,IndustryType:null,Status:null,options:null,selected:!1,selectoptions:[],isPriceInfo:!1,discountType:0,onEditPriceInfo:!1,priceInformation:[],submited:!1,vSelectValidate:!1,pricebookid:this.$route.params.id,DependentOption:[{useCurrent:!1,showClear:!0,showClose:!0,allowInputToggle:!0,minDate:!1}],userId:null,companyId:null,dateformat:null}},created:function(){this.userId=this.GetUserInfo.ID,this.companyId=this.GetUserInfo.CompanyId,this.dateformat=this.GetUserInfo.DateFormat,this.FetchData()},methods:{onSearch:function(e,t){e&&this.searchSelectData(e,this,t)},searchSelectData:function(e,t,a){this.ShowSearchData(e,t,a,a.value.value)},ShowSearchData:function(e,t,a,n){"undefined"==typeof n&&(n=0);var i="id=&moduleName="+this.$route.params.moduleName+"&type="+a.field_code;r["a"].getDDLData(i+"&search="+escape(e)).then((function(e){var t=[];return e.data,""!=e.data&&(t=e.data),a.select_options=t.DATA,a.select_options}))},setSelectedValue:function(e,t){try{Array.isArray(t)?e.value="object"===Object(o["a"])(t[0])&&null!==t[0]?t[0].value:t[0]:e.value=t}catch(a){}},DependentDateObject:function(e,t){if("effective_start_date"==e.name){var a=new Date;a="undefined"!==typeof t&&""!=t?new Date(Date.parse(t)):e.value,this.DependentOption[0]={useCurrent:!1,showClear:!0,showClose:!0,allowInputToggle:!0,minDate:a},$.each(this.GroupBy,(function(e,t){$.each(t.Data,(function(e,t){"effective_end_date"==t.name&&(t.value="")}))}))}},discountFix:function(e,t){var a=this;if(t.indexOf(".")>=0){var n=t.split(".");n.length>1&&""!=n[1]&&(n[1].length>1?a.priceInformation[e].discount=parseFloat(t).toFixed(2):a.priceInformation[e].discount=parseFloat(t).toFixed(1))}},priceDetails:function(){var e={rangeFrom:"",rangeTo:"",discount:""};this.priceInformation.push(e)},addNewForPriceDetails:function(){if(""!=this.priceInformation[this.priceInformation.length-1].rangeFrom&&""!=this.priceInformation[this.priceInformation.length-1].rangeTo){var e={rangeFrom:"",rangeTo:"",discount:""};this.priceInformation.push(e)}else this.ShowAlert(this.$t("lastOneRowRequired"),"warning",!0,this.$t("Alert"))},deletePriceDetailRow:function(e){var t=this;if(1==t.priceInformation.length)return this.ShowAlert(this.$t("Atleastonerowismandatorytosave"),"warning",!0,this.$t("Alert")),!1;t.confirmR(this.$t("AssetGroup_ConfirmDelete"),!0,this.$t("Delete",["Price Details"]),(function(){t.priceInformation.splice(e,1),t.priceInformation.length<=0&&t.addNewForPriceDetails()}))},checkForFromRange:function(e){parseInt(e.rangeFrom)>=parseInt(e.rangeTo)&&(this.ShowAlert(this.$t("ToRangeValueShouldBeGreater"),"warning",!0,this.$t("Alert")),e.rangeTo="")},checkForPreviousRange:function(e){parseInt(e.rangeFrom)>=parseInt(e.rangeTo)&&(e.rangeTo=""),$.each(this.priceInformation,(function(t,a){parseInt(e.rangeFrom)<=parseInt(a.rangeTo)&&(this.ShowAlert(this.$t("rangeShouldBeGreaterThanPreviousOne"),"warning",!0,this.$t("Alert")),e.rangeFrom="",e.rangeTo="",e.discount="")}))},changevalue:function(e){parseInt(e.rangeFrom)>=parseInt(e.rangeTo)&&(e.rangeTo="")},onchangeForNormalDDL:function(e){try{"price_book_model"==e.name&&(""!=e.value&&void 0!==e.value&&"0"!=e.value?(this.onEditPriceInfo?this.onEditPriceInfo=!1:(this.priceInformation=[],this.priceDetails()),this.isPriceInfo=!0,this.discountType=null==e.value||""==e.value?0:e.value):(this.priceInformation=[],this.isPriceInfo=!1))}catch(t){}},formatDate:function(e){if(e)return moment(String(e),"YYYY-MM-DD").format(String(Globalize.culture().calendar.patterns.d).toUpperCase())},GetLocalizedValue:function(e,t){if(this.isBlank(t)){var a=this.$t(String(e).toUpperCase());return a||/^\s*$/.test(a)?a:(a=this.$t(String(e)),a||/^\s*$/.test(a)?a:e)}a=this.$t(String(t).toUpperCase());return a||/^\s*$/.test(a)?a:(a=this.$t(String(t)),a||/^\s*$/.test(a)?a:t)},GetFieldPlaceHolder:function(e,t,a){var n=this,i=n.GetLocalizedValue(e,t);return i="select"==a?n.$t("SelectField")+i:n.$t("EnterField")+i,i},isBlank:function(e){return!e||/^\s*$/.test(e)},SubmitData:function(e){var t=this;t.$refs.form.validate().then((function(e){if(e){t.isLoading=!0,t.submited=!0;var a=t.LeadData,n=[],i=[];$.each(a,(function(e,a){var r={field_name:a.name,required:a.is_required,length:a.length,type:a.validation_type},s="price_book_id"==a.name?t.pricebookid:"undefined"===typeof a.value?"":a.value;if(s="undefined"===typeof s?"":s,"date"==a.dt_code&&(s=a.value),"checkbox"==a.dt_code){var l=a.select_value.filter((function(e){return null!=e&&""!=e}));s=l.join(",")}if("select"==a.dt_code)try{s="object"===Object(o["a"])(s)&&null!==s?s.value:s}catch(d){}"created_by"==a.name&&(s=t.userId),"modified_by"==a.name&&(s=t.userId),"company_id"==a.name&&(s=t.companyId),"price_book_id"==a.name&&(s=t.pricebookid);var c={field_name:a.name,field_value:s,custom_field_id:a.custom_field_id};n.push(c),i.push(r)}));var s={data:n,priceInformation:t.priceInformation,validation:i},l=JSON.stringify(s);r["a"].PostPriceBook(l).then((function(e){t.isLoading=!1,"1"==e.data[0].Code?(t.pricebookid>0?t.ShowAlert(t.$t("UpdatedSuccess",[t.$t("PriceBook")]),"success",!0,t.$t("Alert")):t.ShowAlert(t.$t("AddedSuccess",[t.$t("PriceBook")]),"success",!0,t.$t("Alert")),t.$router.push({name:"CRMPriceBook"})):t.ShowAlert(t.$t("AddedError",[t.$t("PriceBook")]),"failure",!0,t.$t("Alert")),t.submited=!1}))}}))},MakeArray:function(e,t){var a=[],n=String(e).split(",");if("radio"==t||"checkbox"==t){if(n.length>0)for(var i=0;i<n.length;i++)if(n[i].split("|").length>1){var o={name:n[i].split("|")[0],value:n[i].split("|")[1]};a.push(o)}else{o={name:n[i],value:n[i]};a.push(o)}}else if(n.length>0)for(i=0;i<n.length;i++){o={name:n[i],value:n[i]};a.push(o)}return a},MakeNormalArray:function(e){try{return JSON.parse(e)}catch(t){return e}},MakeSelectArray:function(e){var t=[],a=String(e.select_options).split(",");if(a.length>0&&"Lookup"==e.picklist_options&&"YES"==e.form_field_visibility&&"select"==e.dt_code){var n={name:a[0],value:a[1]};t.push(n)}return t},GetValidation:function(e){var t={};return e.is_required&&(t["required"]=!0),e.length>0&&(t["max"]=e.length),"email"==e.validation_type&&(t["email"]=!0),"date"==e.dt_code&&(t["date_format"]=String(Globalize.culture().calendar.patterns.d).toUpperCase()),"decimal"==e.dt_code&&(t["decimal"]=2),"int"!=e.dt_code&&"bigint"!=e.dt_code||(t["numeric"]=!0),"url"==e.dt_code&&(t["url"]="require_protocol"),t},onCancel:function(){this.$router.push({name:"CRMPriceBook"})},FetchData:function(){var e=this,t=this;t.isLoading=!0;var a="id=".concat(t.$route.params.id,"&moduleName=CRM&subModuleCode=CRM_PRICE_BOOKS&langCode=en");r["a"].getFormLayout(a).then((function(a){if(t.isLoading=!1,t.LeadData=a.data.data,null!=t.LeadData&&t.LeadData.length>0){var n=e.LeadData[0].group_id;$.each(t.LeadData,$.proxy((function(e,a){n=a.group_id,"date"==a.dt_code&&(a.value=""==a.value?null:a.value),"checkbox"==a.dt_code&&(a.select_value=a.value.split(",")),"price_book_model"==a.name&&(t.discountType=null==a.value||""==a.value?0:a.value);var i=$.grep(t.GroupBy,(function(e,t){return e.group_id==n}));if(0==i.length){var o=$.grep(t.LeadData,(function(e,t){return e.group_id==n}));if(t.pricebookid>0&&$.each(o,(function(e,a){if("select"==a.dt_code)try{a.value=a.value.trim()}catch(n){console.log("value is null while trimming")}"custom"==a.dropdown_type&&"Lookup"==a.picklist_options?(a.select_options=t.MakeNormalArray(a.select_options),a.select_value=a.select_options,null!=a.select_options&&a.select_options.length>0&&(a.value=a.select_options[0])):"decimal"==a.dt_code&&"YES"==a.form_field_visibility?a.value=parseFloat(a.value,10).toFixed(2):"date"==a.dt_code&&(a.value=t.$options.filters.formatDate(a.value))})),o.length>0){var r={group_id:n,group_name:o[0].group_name,group_display_name:o[0].group_display_name,Data:o};t.GroupBy.push(r)}}}),t)),""!=a.data.otherData&&void 0!==a.data.otherData&&(t.isPriceInfo=!0,t.priceInformation=a.data.otherData),setTimeout((function(){t.DependentOption[0].minDate=new Date(Date.now())}),1e3)}setTimeout((function(){t.CheckBoxBootstrap()}),500),setTimeout((function(){t.RadioButtonBootstrap()}),500);var i={};t.LeadData.forEach((function(e){""!=e.astype&&"YES"==e.form_field_visibility&&(i[e.name]=e.value)})),t.priceInformation.forEach((function(e,t){i["rangeFrom"+t]=e.rangeFrom,i["rangeTo"+t]=e.rangeTo,i["discount"+t]=e.discount})),t.$refs.form.resetForm({values:i})}))}}},c=l,d=a("2877"),u=Object(d["a"])(c,n,i,!1,null,null,null);t["default"]=u.exports}}]);
//# sourceMappingURL=CRMManagePriceBook.js.map