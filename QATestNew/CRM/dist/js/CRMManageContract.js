(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["CRMManageContract"],{c9e4:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"main-content"},[a("loader",{attrs:{"is-visible":e.isLoading}}),a("div",{attrs:{id:"divMainLeadData"}},[e._m(0),a("div",{staticClass:"border p-3"},[a("Form",{ref:"form",scopedSlots:e._u([{key:"default",fn:function(t){var n=t.valid,o=t.errors;return[a("DynamicForm",{attrs:{schema:e.GroupBy,dateformat:e.dateFormat,DependentOption:e.DependentOption},on:{setDependentDate:e.DependentDateObject,onSearchDDL:e.onSearch,onBlur:e.onBlur,setSelectedValue:e.setSelectedValue}}),a("div",{staticClass:"row flex-row-reverse mt-2"},[a("div",{staticClass:"col-lg-6 text-right"},[a("a",{staticClass:"btn btn-success addContract_a",class:{disabled:e.submited},attrs:{href:"javascript:;",title:"Save"},on:{click:function(t){return e.SubmitData(n,o)}}},[a("em",{staticClass:"fa fa-save pr-2"}),e._v("Save ")]),e._v("Â  "),a("a",{staticClass:"btn btn-danger",attrs:{href:"javascript:void(0)",title:"Cancel"},on:{click:e.onCancel}},[a("em",{staticClass:"fa fa-close pr-2"}),e._v("Cancel ")])]),a("div",{staticClass:"col-lg-6"},[a("div",{staticClass:"py-2"},[a("small",{staticClass:"text-danger"},[e._v(e._s(e.$t("MandatoryString")))])])])])]}}])})],1)])],1)},o=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12 padding-t_8"},[a("div",{staticClass:"theme-primary partition-full"},[a("span",{staticClass:"p-name text-white"},[e._v("Manage Contracts")]),a("span",{staticClass:"float-right"})])])])}],i=a("53ca"),s=(a("b0c0"),a("99af"),a("e9c4"),a("4de4"),a("d3b7"),a("a15b"),a("b680"),a("c35a"),a("a9e3"),a("ac1f"),a("1276"),a("159b"),a("9769")),r=a("5ba0"),l=a("1157"),c=a.n(l),u={components:{DynamicForm:r["a"]},data:function(){return{value:"",isLoading:!1,LeadData:null,LeadOwner:null,GroupBy:[],Channel:null,IndustryType:null,Status:null,contractID:this.$route.params.id,StartDate:"01/01/1990",DependentOption:[{useCurrent:!1,showClear:!0,showClose:!0,allowInputToggle:!0,minDate:new Date(Date.now())},{useCurrent:!1,showClear:!0,showClose:!0,allowInputToggle:!0,minDate:new Date(Date.now())}],DependentOptionEdit:[{useCurrent:!1,showClear:!0,showClose:!0,allowInputToggle:!0,minDate:new Date("01/01/1990")},{useCurrent:!1,showClear:!0,showClose:!0,allowInputToggle:!0,minDate:new Date("01/01/1990")}],selected:!1,selectoptions:[],vSelectValidate:!1,submited:!1,clientData:[],cutomerId:0,isAccountSelected:!1,userid:null,companyId:null,username:null,dateFormat:null}},created:function(){this.userid=this.GetUserInfo.ID,this.companyId=this.GetUserInfo.CompanyId,this.username=this.GetUserInfo.Name,this.dateFormat=this.GetUserInfo.DateFormat,this.FetchData()},methods:{DependentDateObject:function(e,t){if("contract_start_date"==e.name){var a=new Date;a="undefined"!==typeof t&&""!=t?new Date(Date.parse(t)):e.value,this.DependentOption[0]={useCurrent:!1,showClear:!0,showClose:!0,allowInputToggle:!0,minDate:a},c.a.each(this.GroupBy,(function(e,t){c.a.each(t.Data,(function(e,t){"contract_end_date"==t.name&&(t.value="")}))}))}else if("billing_start_date"==e.name){a=new Date;a="undefined"!==typeof t&&""!=t?new Date(Date.parse(t)):e.value,this.DependentOption[1]={useCurrent:!1,showClear:!0,showClose:!0,allowInputToggle:!0,minDate:a},c.a.each(this.GroupBy,(function(e,t){c.a.each(t.Data,(function(e,t){"billing_end_date"==t.name&&(t.value="")}))}))}},onKeyDown:function(){ajaxRequestComplete=!0},onSearch:function(e,t){this.searchSelectData(e,this,t)},searchSelectData:function(e,t,a){this.ShowSearchData(e,t,a)},ShowSearchData:function(e,t,a){var n="id=&moduleName=".concat(t.$route.params.moduleName,"&type=").concat(a.field_code);s["a"].getDDLData(n+"&search="+escape(e)).then((function(e){var t=e.data;if(null!=t)return a.select_options=t.DATA,a.select_options}))},setSelectedValue:function(e,t){try{Array.isArray(t)?e.value=t[0]:e.value=t,"account_id"==e.name&&this.getclientAssociatedWithAccount(e.value)}catch(a){}},getclientAssociatedWithAccount:function(e){var t=this,a={sourceId:"",moduleName:"CRM",subModuleCode:"CRM_CONTRACTS",accountName:"",contactIds:[],accountId:e};clientData=[];var n=JSON.stringify(a);s["a"].ConvertLead(n).then((function(a){if("Success"==a.data[0].Status){var n=t.MakeNormalArray(a.body[0].Value);t.clientData=n.CLIENTS;var o={user_id:0,first_name:"",last_name:"",email_id:"",account_id:e};t.clientData.push(o),t.isAccountSelected=!0}setTimeout("RadioButtonBootstrap()",500),setTimeout("ResponsiveDataTable('tablelistingdata')",500)}))},SubmitData:function(e,t){var a=this;a.$refs.form.validate().then((function(e){if(a.vSelectValidate=!0,e){a.isLoading=!0,a.submited=!0;var t=a.LeadData,n=[],o=[],r=c()("input[name='radio_clients']:checked").val(),l=c.a.grep(a.clientData,(function(e,t){return e.user_id==r}));c.a.each(t,(function(e,t){var s={field_name:t.name,required:t.is_required,length:t.length,type:t.validation_type},r="contract_id"==t.name?a.stageID:"undefined"===typeof t.value?"":t.value;if(r="undefined"===typeof r?"":r,"date"==t.dt_code&&(r=t.value),"checkbox"==t.dt_code){var l=t.select_value.filter((function(e){return null!=e&&""!=e}));r=l.join(",")}if("select"==t.dt_code)try{r="object"===Object(i["a"])(r)&&null!==r?r.value:r}catch(u){}"created_by"==t.name&&(r=a.userid),"modified_by"==t.name&&(r=a.userid),"company_id"==t.name&&(r=a.companyId),"contract_id"==t.name&&(r=a.contractID),"created_at"==t.name&&(r=a.$options.filters.formatDate(new Date)),"modified_at"==t.name&&(r=a.$options.filters.formatDate(new Date));var c={field_name:t.name,field_value:r,custom_field_id:t.custom_field_id};n.push(c),o.push(s)}));var u={data:n,validation:o,clientData:l},d=JSON.stringify(u);s["a"].PostContract(d).then((function(e){a.isLoading=!1,"1"==e.data[0].Code?(a.contractID>0?a.ShowAlert(a.$t("UpdatedSuccess",[a.$t("Contract")]),"success",!0,a.$t("Alert")):a.ShowAlert(a.$t("AddedSuccess",[a.$t("Contract")]),"success",!0,a.$t("Alert")),a.$router.push({name:"Contract"})):a.ShowAlert(a.$t("AddedError",[a.$t("Contract")]),"failure",!0,a.$t("Alert")),a.submited=!1}))}}))},onBlur:function(e){try{String(e.value).length>1&&(e.value=Number.parseFloat(e.value).toFixed(2),this.$refs.form.setFieldValue(e.name,e.value))}catch(t){}},onCancel:function(){this.$router.push({name:"Contract"})},MakeNormalArray:function(e){if(e)try{return JSON.parse(e)}catch(t){return e}else e=[]},MakeSelectArray:function(e){var t=[],a=String(e.select_options).split(",");if(a.length>0&&"Lookup"==e.picklist_options&&"YES"==e.form_field_visibility&&"select"==e.dt_code){var n={name:a[0],value:a[1]};t.push(n)}return t},FetchData:function(){var e=this;e.isLoading=!0;var t="id=".concat(e.$route.params.id,"&moduleName=CRM&subModuleCode=CRM_CONTRACTS&langCode=en");s["a"].getFormLayout(t).then((function(t){if(e.isLoading=!1,e.LeadData=t.data.data,null!=e.LeadData&&e.LeadData.length>0){var a=e.LeadData[4];e.LeadData[4]=e.LeadData[8],e.LeadData[8]=a;var n=e.LeadData[0].group_id;c.a.each(e.LeadData,c.a.proxy((function(t,a){n=a.group_id;var o=c.a.grep(e.GroupBy,(function(e,t){return e.group_id==n}));if("customer_id"==a.name&&(e.cutomerId=a.value),"checkbox"==a.dt_code&&(a.select_value=a.value.split(",")),"status_id"==a.name&&(e.LeadData[t].is_required=!0),0==o.length){var i=c.a.grep(e.LeadData,(function(e,t){return e.group_id==n}));if(e.contractID>0&&c.a.each(i,(function(t,a){"custom"==a.dropdown_type&&"Lookup"==a.picklist_options?(a.select_options=e.MakeNormalArray(a.select_options),a.select_value=a.select_options,null!=a.select_options&&a.select_options.length>0&&(a.value=a.select_options[0])):e.isBlank(a.value)||"decimal"!=a.dt_code||"YES"!=a.form_field_visibility?"date"==a.dt_code&&(a.value=a.value):a.value=parseFloat(a.value,10).toFixed(2)})),i.length>0){var s={group_id:n,group_name:i[0].group_name,group_display_name:i[0].group_display_name,Data:i};e.GroupBy.push(s)}}}),e))}setTimeout((function(){e.CheckBoxBootstrap()}),100),setTimeout((function(){e.RadioButtonBootstrap()}),500);var o={};e.LeadData.forEach((function(e){""!=e.astype&&"YES"==e.form_field_visibility&&(o[e.name]=e.value)}))}))}}},d=u,p=a("2877"),m=Object(p["a"])(d,n,o,!1,null,null,null);t["default"]=m.exports}}]);
//# sourceMappingURL=CRMManageContract.js.map