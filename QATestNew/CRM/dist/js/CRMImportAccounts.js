(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["CRMImportAccounts"],{"47f6":function(t,e,a){"use strict";a.r(e);var l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("loader",{attrs:{"is-visible":t.isLoading}}),a("section",{staticClass:"main-content",attrs:{id:"main-content"}},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12 padding-t_8"},[a("div",{staticClass:"theme-primary partition-full"},[a("span",{staticClass:"p-name text-white"},[t._v(t._s(t.$t("Import"))+" "+t._s(t.$t("Accounts")))]),a("span",{staticClass:"p-actions float-right"},[a("a",{staticClass:"p-action-btn text-white float-right",attrs:{href:"javascript:;",id:"btnbacktolist",title:t.$t("BacktoList")},on:{click:t.BackToList}},[a("em",{staticClass:"fa fa-angle-double-left pr-2"}),a("br"),t._v(t._s(t.$t("BacktoList")))])])])])]),a("div",{staticClass:"border p-3"},[a("form",[a("div",{staticClass:"row"},[a("div",{staticClass:"col-lg-12"},[a("div",{staticClass:"form-group"},[a("label",[t._v(t._s(t.$t("Download"))+" "+t._s(t.$t("SampleFile"))+":")]),a("div",{staticClass:"d-flex align-items-center"},[a("p",[a("a",{staticClass:"text-dark",attrs:{href:"/Content/files/ImportAccountsSampleFile.xlsx",checkprivilege:"no",download:""}},[a("img",{staticClass:"mr-2",attrs:{src:"/Content/images/assets/excel-icon.png",alt:""}}),t._v(t._s(t.$t("Accounts"))+" "),a("em",{staticClass:"fa fa-download ml-2 text-dark"})])])])])]),a("div",{staticClass:"col-xl-4 col-lg-4 col-md-6"},[a("div",{staticClass:"form-group"},[a("label",[t._v(t._s(t.$t("UploadFile"))+":"),a("span",{staticClass:"text-danger"},[t._v("*")])]),a("div",{staticClass:"custom-file"},[a("input",{staticClass:"downloadexcel",attrs:{type:"file",id:"flUserFile",size:"19",name:"flUserFile",tabindex:"1"},on:{change:function(e){return t.setFile(e)}}})])])]),a("div",{staticClass:"col-xl-5 col-lg-6 col-md-12 mt-lg-4 pl-lg-0 p-2"},[a("a",{staticClass:"btn btn-success mr-2",attrs:{href:"javascript:void(0);",id:"uploadfile",title:t.$t("ImportFromExcelFile")},on:{click:t.UploadContactFile}},[a("em",{staticClass:"fa fa-sign-in pr-2",attrs:{"aria-hidden":"true"}}),t._v(t._s(t.$t("ImportFromExcelFile")))]),a("a",{staticClass:"btn btn-danger",attrs:{href:"/CRM/ImportAccounts",id:"",title:t.$t("Reset")}},[a("em",{staticClass:"fa fa-refresh mr-2 "}),t._v(t._s(t.$t("Reset")))])]),t._m(0)])])])]),a("div",{staticClass:"col-lg-12 p-0 float-left"},[a("div",{staticClass:"listing mt-2"},[a("div",{staticClass:"table-responsive"},[a("table",{staticClass:"table table-bordered dt-responsive nowrap mt-0",staticStyle:{width:"100%"},attrs:{id:"tblBulkContact","aria-describedby":"importaccount"}},[t._m(1),a("tbody",[a("tr",[a("td",{staticClass:"text-center text-danger norecord no-record",attrs:{colspan:"2"}},[t._v(t._s(t.$t("NoRecordfound")))])]),a("tr",{staticClass:"d-none",attrs:{id:"trdata",crtrwid:"1001"}},[a("td",[a("select",{staticClass:"form-control d-none",attrs:{name:"TableColumns"}},[a("option",{attrs:{value:""}},[t._v(t._s(t.$t("Select"))+" "+t._s(t.$t("Column")))])]),a("select",{staticClass:"form-control",attrs:{id:"ddlTableColumn",name:"TableColumn"}})]),a("td",[a("select",{staticClass:"form-control",attrs:{name:"ExcelColumns"}},[a("option",{attrs:{value:""}},[t._v(t._s(t.$t("Select"))+" "+t._s(t.$t("Column")))])]),a("select",{staticClass:"form-control",attrs:{id:"ddlExcelColumn",name:"ExcelColumn"}})])])])])]),a("div",{staticClass:"clearfix"}),a("div",{staticClass:"col-lg-12 text-right mt-3"},[a("input",{attrs:{type:"hidden",id:"hdnBatchId",value:"Batch_id"}}),a("a",{staticClass:"btn btn-success my-2 d-none",attrs:{href:"javascript:void(0);",id:"savebtn",title:t.$t("Save")},on:{click:t.SaveContactFile}},[a("em",{staticClass:"fa fa-save pr-2"}),a("span",[t._v(t._s(t.$t("Save")))])])])])])],1)},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col-lg-12"},[a("div",{staticClass:"py-2"},[a("span",{staticClass:"text-danger"},[a("small",[t._v("Fields marked with an asterisk (*) are mandatory.")])])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",{staticClass:"thead-bg"},[a("tr",[a("th",{attrs:{scope:"col"}},[t._v("Table Column")]),a("th",{attrs:{scope:"col"}},[t._v("Excel Column")])])])}],n=(a("b0c0"),a("99af"),a("ac1f"),a("5319"),a("7db0"),a("d3b7"),a("498a"),a("e9c4"),a("9769")),i={data:function(){return{isLoading:!1,file:null,filepath:null,excelFileName:null,reqfrom:null}},created:function(){this.reqfrom=this.$route.params.reqfrom},methods:{BackToList:function(){this.$router.push({name:"CRMAccounts"})},setFile:function(t){this.file=t.target.files[0],this.excelFileName=t.target.files[0].name},UploadContactFile:function(){this.isLoading=!0;var t=this,e=new FormData;e.append("file",t.file),n["a"].ImportContactsPost(e).then((function(e){var a=e.data;0==a.Status?(t.filepath=a.Msg,setTimeout((function(){t.loadExcelHeader(a.Msg)}),1e3),setTimeout((function(){t.loadTableHeader()}),2e3),t.isLoading=!1):(t.isLoading=!1,t.ShowAlert(a.Msg,"warning",!0,t.$t("Alert")))}))},loadExcelHeader:function(t){var e=this;e.isLoading=!0;var a="filepath=".concat(t,"&excelFileName=").concat(e.excelFileName);n["a"].GetContactExcelColumn(a).then((function(t){var a=t.data;if(e.isLoading=!1,void 0!=a.length){var l=$("#ddlExcelColumn");l.empty(),$.each(a,(function(t,e){$("#hdnBatchId").val(e.batch_id),$("#ddlExcelColumn").append("<option value='"+e.column_Name+"'Data_Type='"+e.data_Type+"' >"+e.column_Name+"</option>")}))}}))},loadTableHeader:function(){var t=this;t.isLoading=!0;var e="submodule=CRM_ACCOUNTS&batchid=".concat($("#hdnBatchId").val());n["a"].GetContactTableColumn(e).then((function(e){var a=e.data;if(t.isLoading=!1,void 0!=a.length){var l=$("#ddlTableColumn");l.empty(),$.each(a,(function(t,e){$("#ddlTableColumn").append("<option value='"+e.column_Name+"'Data_Type='"+e.data_Type+"'Is_Required='"+e.is_Required+"'Picklist_Options='"+e.picklist_Options+"'Custom_Field_Id='"+e.custom_Field_Id+"' >"+e.column_Name.replace(/_/g," ")+"</option>")})),t.createMultiRows(a.length)}}))},createMultiRows:function(t){try{var e=this;$("uploadfile").addClass("disabled"),$("#savebtn").removeClass("d-none");var a=1002;e.isLoading=!0;var l=$("table#tblBulkContact tr#trdata"),s="",n="";$(".norecord").addClass("d-none");for(var i=0;i<t;i++){if($(l).clone().attr({crtrwid:a}).removeClass("d-none").addClass("visible").find("input,a,select,div").each((function(){$(this).attr({id:function(t,e){return e+""+a},name:function(t,e){return e+""+a},value:function(t,e){return e}}),$(this).removeClass("d-none")})).end().appendTo("table#tblBulkContact"),s=$("#ddlExcelColumn").children("option").clone(),n=$("#ddlTableColumn").children("option").clone(),$("table#tblBulkContact tr.visible td select[id='ddlTableColumn"+a+"']").remove(),$("table#tblBulkContact tr.visible td select[name='TableColumns"+a+"']").attr("id","ddlTableColumn"+a),$("table#tblBulkContact tr.visible td select[name='TableColumns"+a+"']").attr("onclick","CheckDuplicateTableRecord(ddlTableColumn"+a+")"),$("table#tblBulkContact tr.visible td select[name='TableColumns"+a+"']").append(n),$("table#tblBulkContact tr.visible td select[id='ddlExcelColumn"+a+"']").remove(),$("table#tblBulkContact tr.visible td select[name='ExcelColumns"+a+"']").attr("id","ddlExcelColumn"+a),$("table#tblBulkContact tr.visible td select[name='ExcelColumns"+a+"']").attr("onclick","CheckDuplicateExcelRecord(ddlExcelColumn"+a+")"),$("table#tblBulkContact tr.visible td select[name='ExcelColumns"+a+"']").append(s),s.length>i){var o=$("#ddlTableColumn"+a+" option[value='"+s[i].value+"']").attr("data_type"),d=$("#ddlExcelColumn"+a+" option[value='"+s[i].value+"']").attr("data_type"),c=$("#ddlTableColumn"+a+" option[value='"+s[i].value+"']").attr("value"),r=$("#ddlExcelColumn"+a+" option[value='"+s[i].value+"']").attr("value");void 0!=o&&void 0!=d&&c.toLowerCase()==r.toLowerCase()&&($("#ddlTableColumn"+a+" option[value='"+s[i].value+"']").attr("selected","selected"),$("#ddlExcelColumn"+a+" option[value='"+s[i].value+"']").attr("selected","selected"))}a++}$("table#tblBulkContact tr.visible[crtrwid ='1001']").removeClass("visible").addClass("d-none"),e.isLoading=!1}catch(u){this.isLoading=!1}},CheckDuplicateTableRecord:function(t){var e,a,l,s=[],n=!0;$("table#tblBulkContact tr#trdata").each((function(){var t=$(this).find("td").eq(0).find("select option:selected").text();s.push(t)}));var i,o,d=1002;for(n=!1,i=1;i<s.length;i++){for(e="#ddlTableColumn"+d,o=i+1;o<s.length;o++)if(s[i]==s[o]&&"Select Column"!=s[i]){n=!0,l=e,a="#ddlTableColumn"+(o-1+1002);break}if(n)break;$(e).removeClass("border border-danger"),$(savebtn).removeClass("disabled"),d++}n&&($(l).addClass("border border-danger"),$(a).addClass("border border-danger"),$(savebtn).addClass("disabled")),n=!1,$("table#tblBulkContact tr#trdata").each((function(){$(this).find("td").eq(1).find("select").hasClass("border-danger")&&$(savebtn).addClass("disabled")}))},CheckDuplicateExcelRecord:function(t){var e,a,l,s=[],n=!0;$("table#tblBulkContact tr#trdata").each((function(){var t=$(this).find("td").eq(1).find("select option:selected").text();s.push(t)}));var i,o,d=1002;n=!1;for(i=1;i<s.length;i++){for(e="#ddlExcelColumn"+d,o=i+1;o<s.length;o++)if(s[i]==s[o]&&"Select Column"!=s[i]){n=!0,l=e,a="#ddlExcelColumn"+(o-1+1002);break}if(n)break;$(e).removeClass("border border-danger"),$(savebtn).removeClass("disabled"),d++}n&&($(l).addClass("border border-danger"),$(a).addClass("border border-danger"),$(savebtn).addClass("disabled")),n=!1,$("table#tblBulkContact tr#trdata").each((function(){$(this).find("td").eq(0).find("select").hasClass("border-danger")&&$(savebtn).addClass("disabled")}))},SaveContactFile:function(){var t=this,e="<contactentries>\n",a=!1,l=0,s=!1;if($("table#tblBulkContact tr.visible").each((function(){if(l=$(this).attr("crtrwid"),$("table#tblBulkContact tr.visible[crtrwid ='"+l+"']").removeClass("alert-warning"),!$(this).hasClass("alert-success"))if(""==$("#ddlTableColumn"+l).val()?($("#ddlTableColumn"+l).addClass("is-invalid"),a=!0):$("#ddlTableColumn"+l).removeClass("is-invalid"),""==$("#ddlExcelColumn"+l).val()?($("#ddlExcelColumn"+l).addClass("is-invalid"),a=!0):$("#ddlExcelColumn"+l).removeClass("is-invalid"),a)$("#lblError").parent().removeClass("d-none"),$("#lblError").html(t.$t("PleaseCorrectHighlightedErrors")),$(document).scrollTop(0);else{$("#lblError").html(""),$("#lblError").parent().addClass("d-none"),l=$(this).attr("crtrwid");var n=$(this).find("#ddlTableColumn"+l).val(),i=$(this).find("#ddlTableColumn"+l).val(),o=$(this).find("#ddlTableColumn"+l).find(":selected").attr("data_type"),d=$(this).find("#ddlTableColumn"+l).find(":selected").attr("Custom_Field_Id"),c=$(this).find("#ddlTableColumn"+l).find(":selected").attr("Picklist_Options"),r=$(this).find("#ddlExcelColumn"+l).val(),u=$("#ddlExcelColumn"+l).find(":selected").attr("data_type");null==c&&(c=""),void 0!=i&&(s=!0,e+="\n<contact>\n\t<batch_id>"+$("#hdnBatchId").val()+"</batch_id>\n\t<row_id>"+l+"</row_id>\n\t<original_column_name>"+n+"_"+c+"</original_column_name>\n\t<column_name>"+i+"</column_name>\n\t<data_type>"+o.toLowerCase()+"</data_type>\n\t<custom_field_id>"+d+"</custom_field_id>\n\t<excel_column_name>"+r.trim().replace(/[\r\n ]+/gm,"_").replace(/[^a-zA-Z0-9_ \s]/gi,"").replace(/[-\s]/g,"_")+"</excel_column_name>\n\t<excel_data_type>"+u.toLowerCase()+"</excel_data_type>\n</contact>\n")}})),e+="\n</contactentries>\n",!a&&s){console.log({xmltrackentries:e,batch_id:$("#hdnBatchId").val()});var i={xmltrackentries:e,batch_id:$("#hdnBatchId").val(),callingSource:"Account"},o=JSON.stringify(i);n["a"].BulkUploadContact(o).then((function(e){t.isLoading=!1;var a=e.data;void 0!=a.length&&t.$router.push({name:"CRMContactImportDetails",params:{subModuleCode:"CRM_ACCOUNTS",reqfrom:"ImportAccounts",batchid:i.batch_id}})}))}}}},o=i,d=a("2877"),c=Object(d["a"])(o,l,s,!1,null,null,null);e["default"]=c.exports}}]);
//# sourceMappingURL=CRMImportAccounts.js.map