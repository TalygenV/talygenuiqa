(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["CRMManageDeal"],{"7c46":function(e,a,t){"use strict";t.r(a);var n=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("loader",{attrs:{"is-visible":e.isLoading}}),t("section",{staticClass:"main-content"},[t("div",{attrs:{id:"divMaindealData"}},[e._m(0),t("div",{staticClass:"border p-3"},[t("Form",{ref:"form",scopedSlots:e._u([{key:"default",fn:function(a){var n=a.valid,o=a.errors;return[t("DynamicForm",{attrs:{schema:e.GroupBy,dateformat:e.GetUserInfo.DateFormat},on:{openaddIndustrypopup:e.openaddIndustrypopup,openaddRoleTitlepopup:e.openaddRoleTitlepopup,openaddLeadSourcepopup:e.openaddLeadSourcepopup,onchangechannel:e.onchangechannel,onSearchDDL:e.onSearch,setSelectedValue:e.setSelectedValue,onBlur:e.onBlur}}),t("div",{staticClass:"row flex-row-reverse mt-2"},[t("div",{staticClass:"col-lg-6 text-right"},[t("a",{staticClass:"btn btn-success AddDealDetail_a",attrs:{href:"javascript:;",title:"Save"},on:{click:function(a){return e.onSubmit(n,o)}}},[t("em",{staticClass:"fa fa-save pr-2"}),e._v("Save ")]),e._v("Â  "),t("a",{staticClass:"btn btn-danger",attrs:{href:"javascript:void(0)",title:"Cancel"},on:{click:e.onCancel}},[t("em",{staticClass:"fa fa-close pr-2"}),e._v("Cancel ")])]),t("div",{staticClass:"col-lg-6"},[t("div",{staticClass:"py-2"},[t("small",{staticClass:"text-danger"},[e._v(e._s(e.$t("MandatoryString")))])])])]),e.showaddindustryModal?t("modaladdindustry",{on:{close:function(a){e.showaddindustryModal=!1},updatedata:e.UpdateSelectJson}}):e._e(),e.showaddroletitleModal?t("modaladdroletitle",{on:{close:function(a){e.showaddroletitleModal=!1},updatedata:e.UpdateSelectJson}}):e._e(),e.showaddleadsourceModal?t("modaladdleadsource",{attrs:{callFrom:"deal"},on:{close:function(a){e.showaddleadsourceModal=!1},updatedata:e.UpdateSelectJson}}):e._e()]}}])})],1)])])],1)},o=[function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"row"},[t("div",{staticClass:"col-md-12 padding-t_8"},[t("div",{staticClass:"theme-primary partition-full"},[t("span",{staticClass:"p-name text-white"},[e._v("Manage deal")]),t("span",{staticClass:"float-right"})])])])}],d=t("53ca"),l=t("c7eb"),i=t("1da1"),c=(t("d3b7"),t("159b"),t("b0c0"),t("ac1f"),t("1276"),t("b680"),t("99af"),t("4de4"),t("a15b"),t("e9c4"),t("c35a"),t("a9e3"),t("9769")),u=t("5ba0"),r=t("4dad"),s=t("3a69"),m=t("e7cc"),p={components:{DynamicForm:u["a"],modaladdindustry:r["a"],modaladdroletitle:s["a"],modaladdleadsource:m["a"]},data:function(){return{isLoading:!1,value:"",LeadData:null,GroupBy:[],dealId:this.$route.params.id,CountryData:null,showaddindustryModal:!1,IndustryItemObject:null,RoleTitleItemObject:null,showaddroletitleModal:!1,showaddleadsourceModal:!1,LeadSourceItemObject:null,clientData:[],cutomerId:0,isAccountSelected:!1,phoneList:[],submited:!1,userid:null,companyId:null,username:null,dateFormat:null}},mounted:function(){},created:function(){this.userid=this.GetUserInfo.ID,this.companyId=this.GetUserInfo.CompanyId,this.username=this.GetUserInfo.Name,this.dateFormat=this.GetUserInfo.DateFormat,this.FetchData()},methods:{FetchData:function(){var e=this;e.isLoading=!0;var a="id=".concat(e.$route.params.id,"&moduleName=CRM&subModuleCode=CRM_DEALS&langCode=en");c["a"].getFormLayout(a).then((function(a){if(e.isLoading=!1,""!=a.data&&null!=a.data){var t="",n="",o="",d=[];if(e.LeadData=a.data.data,null!=e.LeadData&&e.LeadData.length>0){var l=e.LeadData[0].group_id;if(e.LeadData.forEach((function(a){l=a.group_id,"industry_type_id"!=a.name&&"lead_source_id"!=a.name&&"role_title_id"!=a.name||(a.isPlusIcon=!0),"customer_id"==a.name&&(e.cutomerId=""==a.value?0:a.value),"checkbox"==a.dt_code&&(a.select_value=a.value.split(",")),"mobile_phone"==a.name&&(t=a.value,""!=t&&null!=t&&-1!=t.indexOf("+")||d.push(a.name)),"home_phone"==a.name&&(n=a.value,""!=n&&null!=n&&-1!=n.indexOf("+")||d.push(a.name)),"business_phone"==a.name&&(o=a.value,""!=o&&null!=o&&-1!=o.indexOf("+")||d.push(a.name)),"lead_source_id"==a.name&&e.dealId>0&&""!=a.value&&setTimeout((function(){e.onchangechannel(a,null)}),500),"deal_owner_id"==a.name&&(""==a.value?(a.select_value=e.username,a.value={name:a.select_value,value:e.userid,first_value:null,second_value:null},a.select_options=[{name:a.select_value,value:e.userid,first_value:null,second_value:null}]):a.select_options=e.MakeNormalArray(a.select_options));var i=$.grep(e.GroupBy,(function(e,a){return e.group_id==l}));if(0==i.length){var c=$.grep(e.LeadData,(function(e,a){return e.group_id==l}));if(e.dealId>0&&$.each(c,(function(a,t){"custom"==t.dropdown_type&&"Lookup"==t.picklist_options?(t.select_options=e.MakeNormalArray(t.select_options),t.select_value=t.select_options,null!=t.select_options&&t.select_options.length>0&&(t.value=t.select_options[0])):"decimal"==t.dt_code&&"YES"==t.form_field_visibility&&t.value>0?t.value=parseFloat(t.value,10).toFixed(2):"date"==t.dt_code&&(t.value=t.value)})),c.length>0){var u={group_id:l,group_name:c[0].group_name,group_display_name:c[0].group_display_name,Data:c};e.GroupBy.push(u)}}})),e.dealId>0?setTimeout((function(){var a=$('select[name="lead_source_id"] option:selected').text();"Partner"==a||"Consultant"==a||"Provider"==a||"Customer"==a?($(".campaignname").hide(),$.each(items,(function(e,a){"referred_by"==a.name&&(a.value=""),"campaign_id"==a.name&&(a.value="")}))):"Campaign"==a?($(".campaignname").show(),$(".referredby").hide()):($(".campaignname").hide(),$(".referredby").hide(),$.each(e.GroupBy,(function(e,a){$.each(a.Data,(function(e,a){"referred_by"==a.name&&(a.value=""),"campaign_id"==a.name&&(a.value="")}))})))}),500):setTimeout((function(){$(".referredby").hide(),$(".campaignname").hide()}),500),e.dealId>0){var i={};e.LeadData.forEach((function(e){""!=e.astype&&"YES"==e.form_field_visibility&&(i[e.name]=e.value)}))}}}}))},MakeNormalArray:function(e){if(e)try{return JSON.parse(e)}catch(a){return e}else e=[]},FillDropdown:function(){var e=Object(i["a"])(Object(l["a"])().mark((function e(a,t){var n,o,d,i,u;return Object(l["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=this,n.Loading=!0,o="",d="","deal_country"==a.name?(d="ACCOUNT_STATE",null==t&&$.each(n.GroupBy,(function(e,a){$.each(a.Data,(function(e,a){" deal_city"!=a.name&&"deal_state"!=a.name&&"deal_zipcode"!=a.name&&"deal_address1"!=a.name&&"  deal_address2"!=a.name||(a.select_options=null,a.value="")}))}))):"account_id"==a.name&&(d="COMMISSION_AGREEMENT",t="Account"),i=a.name,o=a.value,""==o){e.next=11;break}return u="id=&moduleName=".concat(n.$route.params.moduleName,"&type=").concat(d,"&refId=").concat(o),e.next=11,c["a"].getDDLData(u).then((function(e){n.Loading=!1;var o=[];null!=e.data&&(o=e.data.DATA),$.each(n.GroupBy,(function(e,a){$.each(a.Data,(function(e,a){"deal_state"==a.name&&"deal_country"==i||"deal_city"==a.name&&"deal_state"==i?a.select_options=o:"commission_type"==a.name&&"Account"==t?a.value=o[0].second_value:"agreement_type"==a.name&&"Account"==t&&(a.value=o[0].first_value)}))})),a.name=i}));case 11:case"end":return e.stop()}}),e,this)})));function a(a,t){return e.apply(this,arguments)}return a}(),onchangechannel:function(e,a){var t="",n="",o=this;if("lead_source_id"==e.name){var d=$('select[name="lead_source_id"] option:selected').text();"Partner"==d||"Consultant"==d||"Customer"==d||"Provider"==d?($(".campaignname").hide(),$(".referredby").show(),$.each(a,(function(e,a){"referred_by"==a.name&&(a.value=""),"campaign_id"==a.name&&(a.value="")}))):"Campaign"==d?($(".referredby").hide(),$(".campaignname").show(),$.each(a,(function(e,a){"referred_by"==a.name&&(a.value="")}))):($.each(a,(function(e,a){"referred_by"==a.name&&(a.value=""),"campaign_id"==a.name&&(a.value="")})),$(".referred_by").hide(),$(".campaignname").hide());var l=$('select[name="lead_source_id"] option:selected').text(),i="id=&moduleName=".concat(o.$route.params.moduleName,"&type=ACCOUNTS_LIST&search=").concat(l);c["a"].getDDLData(i).then((function(e){var a=[];null!=e.data&&(a=e.data.DATA),$.each(o.GroupBy,(function(e,t){$.each(t.LeadData,(function(e,t){"referred_by"==t.name&&(t.select_options=a)}))}))}))}else if("account_id"==e.name){if(n="ACCOUNT_CONTACTS",t=e.value,""!=t){i="id=&moduleName=".concat(o.$route.params.moduleName,"&type=").concat(n,"&refId=").concat(t);c["a"].getDDLData(i).then((function(e){var a=[];null!=e.data&&(a=e.data.DATA),$.each(o.GroupBy,(function(e,t){$.each(t.Data,(function(e,t){"contact_name"==t.name&&(t.select_options=a)}))}))}))}}else if("deal_country"==e.name&&(n="STATE",t=e.value,""!=t)){var u="id=&moduleName=".concat(o.$route.params.moduleName,"&type=").concat(n,"&refId=").concat(t);c["a"].getDDLData(u).then((function(e){var a=[];null!=e.data&&(a=e.data.DATA),$.each(o.GroupBy,(function(e,t){$.each(t.Data,(function(e,t){"deal_state"==t.name&&(t.select_options=a)}))}))}))}},onSearch:function(e,a){e&&this.searchSelectData(e,this,a)},searchSelectData:function(e,a,t){this.ShowSearchData(e,a,t,t.value.value)},ShowSearchData:function(e,a,t,n){"undefined"==typeof n&&(n=0);var o="id=&moduleName="+this.$route.params.moduleName+"&type="+t.field_code;"fill"==t.dependent_type&&(o+="&refId="+n),c["a"].getDDLData(o+"&search="+escape(e)).then((function(e){var a=[];return e.data,""!=e.data&&(a=e.data),t.select_options=a.DATA,t.select_options}))},setSelectedValue:function(e,a){var t=this;try{Array.isArray(a)?e.value="object"===Object(d["a"])(a[0])&&null!==a[0]?a[0].value:a[0]:(e.has_dependent>=0&&t.GroupBy.forEach((function(n){n.Data.forEach((function(n){n.parent_id==e.custom_field_id&&"fill"==n.dependent_type&&t.ShowSearchData("",t,n,a.value)}))})),e.value=a),"account_id"==e.name&&t.getclientAssociatedWithAccount(e.value)}catch(n){}},onSubmit:function(e,a){var t=this;this.$refs.form.validate().then((function(e){if(e){t.isLoading=!0;var a=t.LeadData,n=[],o=[],l=$("input[name='radio_clients']:checked").val(),i=$.grep(t.clientData,(function(e,a){return e.user_id==l}));$.each(a,(function(e,a){var l={field_name:a.name,required:a.is_required,length:a.length,type:a.validation_type},i="deal_id"==a.name?t.dealId:"undefined"===typeof a.value?"":a.value;if(i="undefined"===typeof i?"":i,"date"==a.dt_code&&(i=a.value),"checkbox"==a.dt_code){var c=a.select_value.filter((function(e){return null!=e&&""!=e}));i=c.join(",")}if("select"==a.dt_code)try{i="object"===Object(d["a"])(i)&&null!==i?i.value:i}catch(r){}"created_by"==a.name&&(i=t.userid),"modified_by"==a.name&&(i=t.userid),"company_id"==a.name&&(i=t.companyId);var u={field_name:a.name,field_value:i,custom_field_id:a.custom_field_id};n.push(u),o.push(l)}));var u={data:n,validation:o,clientData:i},r=JSON.stringify(u);console.log(r),c["a"].PostDeal(r).then((function(e){t.isLoading=!1,"1"==e.data[0].Code?(t.dealId>0?t.ShowAlert(t.$t("UpdatedSuccess",[t.$t("Deal")]),"success",!0,t.$t("Alert")):t.ShowAlert(t.$t("AddedSuccess",[t.$t("Deal")]),"success",!0,t.$t("Alert")),t.onCancel()):t.ShowAlert(t.$t("AddedError",[t.$t("Deal")]),"failure",!0,t.$t("Alert")),t.submited=!1}))}}))},onCancel:function(){this.$router.push({name:"CRMDeal"})},UpdateSelectJson:function(e,a){$.each(this.GroupBy,(function(t,n){$.each(n.Data,(function(t,n){n.name==e&&(n.select_options=a)}))}))},openaddIndustrypopup:function(e){this.IndustryItemObject=e,this.showaddindustryModal=!0},openaddRoleTitlepopup:function(e){this.RoleTitleItemObject=e,this.showaddroletitleModal=!0},openaddLeadSourcepopup:function(e){this.LeadSourceItemObject=e,this.showaddleadsourceModal=!0},onBlur:function(e){try{String(e.value).length>1&&(e.value=Number.parseFloat(e.value).toFixed(2),this.$refs.form.setFieldValue(e.name,e.value))}catch(a){}},getclientAssociatedWithAccount:function(e){var a=this,t={sourceId:"",moduleName:"CRM",subModuleCode:"CRM_DEALS",accountName:"",contactIds:[],accountId:e};this.clientData=[];var n=JSON.stringify(t);c["a"].ConvertLead(n).then((function(t){if("Success"==t.data[0].Status){var n=a.MakeNormalArray(t.body[0].Value);a.clientData=n.CLIENTS;var o={user_id:0,first_name:"",last_name:"",email_id:"",account_id:e};a.clientData.push(o),a.isAccountSelected=!0}setTimeout("RadioButtonBootstrap()",500),setTimeout("ResponsiveDataTable('tablelistingdata')",500)}))}}},f=p,h=t("2877"),_=Object(h["a"])(f,n,o,!1,null,null,null);a["default"]=_.exports}}]);
//# sourceMappingURL=CRMManageDeal.js.map